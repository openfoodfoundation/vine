import{r as f,o as N,c as a,a as i,b as m,u as n,h as $,w as v,d as t,e as u,t as o,l as j,f as r,F as y,g as B,i as V,m as I,x as P,L as A}from"./app-BnsIz3m0.js";import{_ as E,S as p}from"./AuthenticatedLayout-C2MRZn9A.js";import{d as l}from"./dayjs.min-qm02jCzg.js";import{r as F}from"./relativeTime-COb53a5N.js";import{l as L}from"./localizedFormat-CWRC6j90.js";import{u as U}from"./utc-BuHW2XgP.js";import{P as x}from"./PrimaryButton-Cjsu0ZgV.js";import{_ as Y}from"./SecondaryButton-BJ1ggkiH.js";import"./ApplicationLogo-5vc_I7Zx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"grid grid-cols-2 gap-8 container mx-auto mt-8"},O={class:"card"},q={class:"opacity-25"},z={key:0,class:"mt-4"},G={key:1,class:"font-bold text-red-500 text-sm"},H={class:"card"},J={key:0},K={class:"card"},Q={class:"grid grid-cols-4 gap-y-12 text-center mt-8"},W={class:"font-bold text-3xl"},X={class:"font-bold text-3xl"},Z={class:"font-bold text-3xl"},ee={key:0},te={class:"font-bold text-3xl"},se={class:"text-xs"},oe={key:1},ie={class:"font-bold text-3xl"},ae={class:"text-xs"},de={class:"grid grid-cols-2 gap-8 container mx-auto"},re={class:"card"},le={key:0},ne={key:1,class:"text-xs mt-2"},ue={class:"card"},ce={key:0},ve={class:"card"},_e={key:0,class:"text-sm"},me={class:"border-b py-2 sm:p-2"},fe={class:"font-bold"},he={key:0},be={class:"font-bold"},ye={key:1},pe={class:"font-bold"},xe={class:"card"},ge={class:"card-header flex justify-between"},ke={class:"mt-4"},we={key:0},Be={class:"py-1 border-b border-gray-200 flex justify-between"},Ve={class:"font-medium"},Ce={class:"italic text-gray-500"},De={key:1},Se={class:"mt-8"},Te={class:"mt-2 flex justify-between"},Re={class:"w-full"},Ne={class:"flex space-x-4"},Me={__name:"Voucher",props:{voucherId:{type:String,required:!1}},setup(C){l.extend(F),l.extend(L),l.extend(U);const D=C,_=f(""),h=f(null),b=f(!1),s=f({});N(()=>{w()});function g(){b.value=!1,_.value=""}function S(){p.fire({title:"Are you sure?",icon:"warning",text:"You cannot resend this voucher to a different email address after this. You can resend it to the same person, but not a different person. Please double-check you have the details correct.",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"All good, send it!",cancelButtonText:"Go back"}).then(c=>{c.isConfirmed&&k()})}function k(){let c={voucher_id:s.value.id,beneficiary_email:_.value};s.value.voucher_beneficiary_distributions?.length>=1&&(c={resend_beneficiary_distribution_id:s.value.voucher_beneficiary_distributions[0].id}),axios.post("/voucher-beneficiary-distributions",c).then(e=>{p.fire({title:"Nice!",icon:"success",text:e.data.data.message,showConfirmButton:!1,timer:600}),g(),w()}).catch(e=>{p.fire({title:"Oops!",icon:"error",text:e.response.data.meta.message}),console.log(e)})}function w(){axios.get("/my-team-vouchers/"+D.voucherId+"?cached=false&relations=createdByTeam,allocatedToServiceTeam,voucherBeneficiaryDistributions,voucherRedemptions.redeemedByUser,voucherRedemptions.redeemedByTeam,voucherSet").then(c=>{s.value=c.data.data}).catch(c=>{console.log(c)})}function T(){b.value=!0,A(()=>{h.value&&h.value.scrollIntoView({behavior:"smooth"})})}return(c,e)=>(i(),a(y,null,[m(n($),{title:"Voucher"}),m(E,null,{header:v(()=>[...e[1]||(e[1]=[r(" Voucher ",-1)])]),default:v(()=>[t("div",M,[t("div",O,[e[2]||(e[2]=t("div",{class:"card-header"}," Voucher Details ",-1)),t("h2",q," ID: "+o(s.value.id),1),s.value.voucher_short_code?(i(),a("div",z,[t("h2",null," Short Code: "+o(s.value.voucher_short_code),1)])):u("",!0),s.value.is_test?(i(),a("div",G," Test voucher ")):u("",!0)]),t("div",H,[e[3]||(e[3]=t("div",{class:"card-header"}," Voucher set ",-1)),s.value.voucher_set_id?(i(),a("div",J,[m(n(j),{href:c.route("voucher-set",{id:s.value.voucher_set_id})},{default:v(()=>[r(o(s.value.voucher_set_id),1)]),_:1},8,["href"])])):u("",!0)])]),t("div",K,[e[9]||(e[9]=t("div",{class:"card-header"}," Usage overview ",-1)),t("div",Q,[t("div",null,[t("div",W," $"+o(s.value.voucher_value_original/100),1),e[4]||(e[4]=r(" Original value ",-1))]),t("div",null,[t("div",X," $"+o(s.value.voucher_value_remaining/100),1),e[5]||(e[5]=r(" Remaining value ",-1))]),t("div",null,[t("div",Z,o(s.value.num_voucher_redemptions??"0"),1),e[6]||(e[6]=r(" # Redemptions ",-1))]),s.value.last_redemption_at?(i(),a("div",ee,[e[7]||(e[7]=t("div",null," Last redeemed ",-1)),t("div",te,o(n(l).utc(s.value.last_redemption_at).fromNow()),1),t("div",se," ("+o(n(l)(s.value.last_redemption_at))+") ",1)])):u("",!0),s.value.voucher_set?.expires_at?(i(),a("div",oe,[e[8]||(e[8]=t("div",null," Expires ",-1)),t("div",ie,o(n(l).utc(s.value.voucher_set.expires_at).fromNow()),1),t("div",ae," ("+o(n(l)(s.value.voucher_set.expires_at))+") ",1)])):u("",!0)])]),t("div",de,[t("div",re,[e[10]||(e[10]=t("div",{class:"card-header"}," Created by team ",-1)),s.value.created_by_team?(i(),a("div",le,o(s.value.created_by_team.name),1)):u("",!0),s.value.created_at?(i(),a("div",ne," Created at: "+o(n(l).utc(s.value.created_at).fromNow())+" ("+o(n(l)(s.value.created_at))+") ",1)):u("",!0)]),t("div",ue,[e[11]||(e[11]=t("div",{class:"card-header"}," Allocated to team ",-1)),s.value.allocated_to_service_team?(i(),a("div",ce,o(s.value.allocated_to_service_team.name),1)):u("",!0)])]),t("div",ve,[e[15]||(e[15]=t("div",{class:"card-header"}," Voucher redemptions ",-1)),s.value.voucher_redemptions&&s.value.voucher_redemptions.length?(i(),a("div",_e,[(i(!0),a(y,null,B(s.value.voucher_redemptions,d=>(i(),a("div",me,[t("div",null,[e[12]||(e[12]=r(" Redeemed amount: ",-1)),t("span",fe,"$"+o(d.redeemed_amount/100),1)]),d.redeemed_by_user&&d.redeemed_by_team?(i(),a("div",he,[e[13]||(e[13]=r(" Redeemed by: ",-1)),t("span",be,o(d.redeemed_by_user.name)+" ("+o(d.redeemed_by_team.name)+")",1)])):u("",!0),d.created_at?(i(),a("div",ye,[e[14]||(e[14]=r(" Redeemed at: ",-1)),t("span",pe,o(n(l).utc(d.created_at).fromNow())+" ("+o(n(l)(d.created_at))+")",1)])):u("",!0)]))),256))])):u("",!0)]),t("div",xe,[t("div",ge,[e[18]||(e[18]=t("div",null,[t("div",null," Beneficiary Distributions ")],-1)),t("div",null,[s.value.voucher_beneficiary_distributions?.length?(i(),V(x,{key:0,onClick:k},{default:v(()=>[...e[16]||(e[16]=[r(" Resend ",-1)])]),_:1})):(i(),V(x,{key:1,onClick:T},{default:v(()=>[...e[17]||(e[17]=[r(" Send to beneficiary ",-1)])]),_:1}))])]),t("div",ke,[s.value.voucher_beneficiary_distributions?.length?(i(),a("div",we,[(i(!0),a(y,null,B(s.value.voucher_beneficiary_distributions,(d,R)=>(i(),a("div",Be,[t("div",Ve,o(R===0?"Distributed":"Re-distributed")+" "+o(n(l).utc(d.created_at).fromNow()),1),t("div",Ce,o(n(l)(d.created_at).format("llll")),1)]))),256))])):(i(),a("div",De," This voucher has not been distributed yet. "))])]),b.value?(i(),a("div",{key:0,ref_key:"distributionSectionRef",ref:h,class:"card"},[e[22]||(e[22]=t("div",{class:"card-header"},[r(" Distribute to beneficiary "),t("div",{class:"text-xs"}," You can email this voucher to a beneficiary here. ")],-1)),t("div",Se,[e[21]||(e[21]=t("label",{for:"beneficiary-email"}," Please enter the beneficiary's email ",-1)),t("div",Te,[t("div",Re,[I(t("input",{id:"beneficiary-email","onUpdate:modelValue":e[0]||(e[0]=d=>_.value=d),class:"md:w-1/3",placeholder:"beneficiary@example.com",type:"email"},null,512),[[P,_.value]])]),t("div",Ne,[m(Y,{onClick:g},{default:v(()=>[...e[19]||(e[19]=[r(" Cancel ",-1)])]),_:1}),m(x,{disabled:!_.value,class:"disabled:cursor-not-allowed disabled:opacity-25",onClick:S},{default:v(()=>[...e[20]||(e[20]=[r(" Send ",-1)])]),_:1},8,["disabled"])])])])],512)):u("",!0),e[23]||(e[23]=t("div",{class:"pb-32"},null,-1))]),_:1})],64))}};export{Me as default};
