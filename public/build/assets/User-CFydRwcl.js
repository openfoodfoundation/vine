import{r as b,Q as T,o as O,a as i,b as o,d as l,u as m,w as r,F as _,Z as Q,e,t as c,i as y,f as v,h as p,j as f,p as U,v as S,m as z,n as $,k as E}from"./app-De6ADG2Z.js";import{_ as W}from"./AuthenticatedLayout-Ddc8y2KE.js";import{_ as Z}from"./AdminTopNavigation-CiIcEXyl.js";import{S as A}from"./sweetalert2.all-CiIoo-le.js";import{P as G}from"./PaginatorComponent-5ycE4kq2.js";import{_ as H}from"./AdminUserDetailsComponent-CeQgIDVw.js";import{P as x}from"./PrimaryButton-7kF1Zoeu.js";import{_ as J}from"./TextInput-D6Kj0igu.js";import{_ as K}from"./SecondaryButton-BkDohym5.js";import"./ApplicationLogo-CmYXJ9Tu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"card"},X={class:"flex justify-between items-center"},Y={key:0},ee={class:"card"},te=e("div",{class:"card-header"}," User details ",-1),se={class:"card"},ae=e("div",{class:"card-header"}," User teams ",-1),ie={key:0},oe={key:0},ne={key:0,class:"text-xs text-red-500"},le={class:""},de={class:"flex justify-end items-center mt-4"},re={class:"w-full lg:w-1/3"},ce={class:"card"},ue=e("div",{class:"card-header"}," Admin status ",-1),me={for:"admin",class:"cursor-pointer flex justify-start items-center"},_e={class:"card"},ve=e("div",{class:"card-header"}," User Personal Access Tokens (PATs) ",-1),pe={key:0},he={class:"border-b py-2"},fe={class:"list-item ml-8"},ke={key:0},be={class:"ml-8 text-xs"},ge={key:1},ye={class:"card"},Ae=e("div",{class:"card-header"}," Create Personal Access Token ",-1),xe={key:0},Pe=e("div",{class:"mt-8 mb-4"},[e("h2",null,"Step 1: Select Token Abilities")],-1),we={class:"flex justify-start items-center space-x-4 pb-4"},Ce=e("div",{class:"pl-16"}," Quick select: ",-1),Te={class:"grid grid-cols-1 md:grid-cols-2 md:gap-2"},Ue={class:"border rounded-xl p-4"},Se={class:"text-xs"},$e={class:"mt-8"},Be=["for"],Ve=["id","value"],je=e("div",{class:"mt-8"},[e("h2",null,"Step 2: Give the Token a name")],-1),Ne={class:"pb-4"},De={class:"flex items-center justify-end mt-4"},Ge={__name:"User",props:{id:{required:!0,type:Number}},setup(B){const k=B,V=b(5),n=b({name:"",token_abilities:[]}),P=T().props.personalAccessTokenAbilities,j=T().props.platformAppTokenAbilities,u=b({}),d=b({});O(()=>{g(),w()});function N(){n.value.user_id=d.value.id,axios.post("/admin/user-personal-access-tokens",n.value).then(s=>{let a=s.data.data.token;A.fire({title:"Personal access token issued!",html:"Please note that the token will be displayed only once. Make sure to save it securely. </br> <b>"+a+"</b>",icon:"warning",confirmButtonColor:"#3085d6",confirmButtonText:"Got it"}).then(t=>{n.value={name:"",token_abilities:[]},g()})}).catch(s=>{A.fire({icon:"error",title:"Oops..",text:s.response.data.meta.message})})}function g(){axios.get("/admin/users/"+k.id+"?cached=false&relations=currentTeam").then(s=>{d.value=s.data.data}).catch(s=>{console.log(s)})}function w(s=1){axios.get("/admin/team-users?cached=false&page="+s+"&where[]=user_id,"+k.id+"&relations=team&limit="+V.value+"&orderBy=id,desc").then(a=>{u.value=a.data.data}).catch(a=>{})}function D(s){w(s)}function C(s){return s.replaceAll("-"," ")}function I(){n.value.token_abilities=Object.keys(j),A.fire({icon:"info",title:"Platform Apps",html:'<div>We have selected the minimum required abilities for an API token for a "Platform" type app.</div><div class="mt-4">Be careful with these abilities, as they can perform additive and destructive actions, like creating teams, users and more API tokens.</div>'})}function M(){n.value.token_abilities=[]}function q(){let s={is_admin:d.value.is_admin};axios.put("/admin/users/"+k.id,s).then(a=>{g()}).catch(a=>{console.log(a)})}return(s,a)=>(i(),o(_,null,[l(m(Q),{title:"Users"}),l(W,null,{header:r(()=>[l(Z)]),default:r(()=>[e("div",R,[e("div",X,[e("h2",null,c(d.value.name),1),e("div",null,[s.$page.props.isImpersonating===null?(i(),o("div",Y,[l(x,null,{default:r(()=>[l(m(y),{href:s.route("admin.impersonate",k.id)},{default:r(()=>[v("Impersonate")]),_:1},8,["href"])]),_:1})])):p("",!0)])])]),e("div",ee,[te,l(H,{user:d.value},null,8,["user"])]),e("div",se,[ae,u.value.data&&u.value.data.length>0?(i(),o("div",ie,[(i(!0),o(_,null,f(u.value.data,t=>(i(),E(m(y),{href:s.route("admin.team",t.team_id),class:"hover:no-underline hover:opacity-75"},{default:r(()=>[e("div",{class:$({"border-b p-2":u.value.data.length>1})},[t.team?(i(),o("div",oe,[t.team_id===d.value.current_team_id?(i(),o("div",ne,"*Current team ")):p("",!0),e("div",le,c(t.team.name),1)])):p("",!0)],2)]),_:2},1032,["href"]))),256))])):p("",!0),e("div",de,[e("div",re,[l(G,{onSetDataPage:D,"pagination-data":u.value},null,8,["pagination-data"])])])]),e("div",ce,[ue,e("label",me,[U(e("input",{onChange:a[0]||(a[0]=t=>q()),type:"checkbox",id:"admin",class:"mr-4","true-value":1,"false-value":0,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.is_admin=t)},null,544),[[S,d.value.is_admin]]),v(" User is System Admin ")])]),e("div",_e,[ve,d.value.tokens&&d.value.tokens.length?(i(),o("div",pe,[(i(!0),o(_,null,f(d.value.tokens,t=>(i(),o("div",he,[l(m(y),{href:s.route("admin.api-access-token",{id:t.id})},{default:r(()=>[e("div",fe,c(t.name),1),t.abilities&&t.abilities.length?(i(),o("div",ke,[(i(!0),o(_,null,f(t.abilities,h=>(i(),o("div",be," - "+c(C(h)),1))),256))])):p("",!0)]),_:2},1032,["href"])]))),256))])):(i(),o("div",ge,"User does not have PATs."))]),e("div",ye,[Ae,m(P).length?(i(),o("div",xe,[Pe,e("div",we,[l(K,{onClick:M},{default:r(()=>[v(" Clear Selected ")]),_:1}),Ce,l(x,{onClick:a[2]||(a[2]=t=>I())},{default:r(()=>[v(" Platform App ")]),_:1})]),e("div",Te,[(i(!0),o(_,null,f(m(P),t=>(i(),o("div",Ue,[e("div",null,[e("h2",null,c(t.name),1),e("div",Se,c(t.description),1),e("div",$e,[(i(!0),o(_,null,f(t.abilities,(h,F)=>(i(),o("div",null,[e("label",{for:h,class:"cursor-pointer"},[U(e("input",{type:"checkbox",id:h,class:"mr-4",value:F,"onUpdate:modelValue":a[3]||(a[3]=L=>n.value.token_abilities=L)},null,8,Ve),[[S,n.value.token_abilities]]),v(" "+c(C(h)),1)],8,Be)]))),256))])])]))),256))]),je,e("div",Ne,[l(J,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:n.value.name,"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.name=t),required:""},null,8,["modelValue"])]),e("div",null," Selected Abilities: "+c(n.value.token_abilities.join(", ")),1),e("div",De,[l(x,{onClick:a[5]||(a[5]=z(t=>N(),["prevent"])),class:$(["",{"opacity-25":!n.value.name}]),desabled:!n.value.name},{default:r(()=>[v(" Create New Token ")]),_:1},8,["class","desabled"])])])):p("",!0)])]),_:1})],64))}};export{Ge as default};
