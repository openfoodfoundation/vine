import{S as V,_ as U}from"./AuthenticatedLayout-CceP5bI9.js";import{r as k,q as D,c as o,a as l,d as e,l as W,s as q,e as d,F as g,h as $,k as C,t as i,o as P,b as _,u as m,g as z,w as h,f as u,S as M,i as A}from"./app-Bxcu2Eth.js";import{_ as I}from"./AdminTopNavigation-BS54z0Xq.js";import{P as B}from"./PrimaryButton-BxPB8kvC.js";import{_ as O}from"./SecondaryButton-BGwQnBNU.js";import{d as p}from"./dayjs.min-EiUFz_hV.js";import{r as G}from"./relativeTime-BB7cfkax.js";import{u as J}from"./utc-D74y0IJH.js";import{_ as K}from"./VouchersComponent-DYgXxklB.js";import{D as R}from"./DangerButton-BD4wQYOE.js";import"./ApplicationLogo-BAZBnrEk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PaginatorComponent-DPOy3Kg3.js";const Q={class:"h-full"},X={key:0,class:""},Y={key:0,class:"mb-8"},Z={class:"flex space-x-4"},ee=["innerHTML"],te=["innerHTML"],se={key:1,class:"mb-8"},le=["onClick"],ae={class:"flex space-x-4"},oe=["innerHTML"],ne={key:2,class:"my-8"},re=["onClick"],ie={class:"flex"},de=["innerHTML"],ue={key:3,class:"my-8"},ve=["onClick"],ce={class:"flex"},me=["innerHTML"],_e={class:"ml-2"},he=["innerHTML"],fe={key:0,class:"absolute top-48 left-0 w-full h-full min-h-full min-w-full"},pe={class:"bg-white border rounded-lg p-4 mt-6 w-3/4 mx-auto z-20 relative overflow-y-scroll max-h-screen"},xe={class:"text-2xl"},ye={__name:"AdminSearchComponent",props:{filterToDataSets:{required:!1,type:String,default:"users,teams,vouchers,voucherSets"}},emits:["itemWasSelected"],setup(L,{emit:T}){const x=L,s=k(""),c=k({users:[],teams:[],vouchers:[],voucherSets:[]}),N=T,w=k(!1),y=k(!1);D(s,()=>{s.value.length>=3?j():(w.value=!1,y.value=!1)}),D(c,()=>{w.value=!1,y.value=!1,s.value.length>=3&&(c.value.users.length||c.value.teams.length||c.value.vouchers.length||c.value.voucherSets.length?w.value=!0:y.value=!0)});function j(){s.value&&s.value.length>=1&&axios.get("/admin/search?cached=false&query="+s.value).then(a=>{c.value=a.data.data}).catch(a=>{V.fire({icon:"error",title:"Oops!",text:a.response.data.message})})}function v(a){let n=new RegExp(s.value,"ig"),r=a.matchAll(n);if(r.length===0)return a;let b=0;return r.forEach(S=>{const F=a.slice(0,S.index+b),E=a.slice(S.index+b+S[0].length),H='<b class="text-blue-500">'+S[0]+"</b>";a=F+H+E,b+=H.length-S[0].length}),a}function t(){c.value={users:[],teams:[],vouchers:[],voucherSets:[]}}function f(a){N("itemWasSelected",a),s.value="",t()}return(a,n)=>(l(),o(g,null,[e("div",null,[W(e("input",{id:"search-box","onUpdate:modelValue":n[0]||(n[0]=r=>s.value=r),autofocus:"",class:"border-gray-200 placeholder:text-gray-400 rounded p-3 w-full text-blue",placeholder:"Search..",type:"search"},null,512),[[q,s.value]]),n[3]||(n[3]=e("div",{class:"text-xs mt-1 text-gray italic"},"Min. 3 chars",-1))]),e("div",Q,[w.value?(l(),o("div",X,[e("div",null,[c.value.users.length>0&&x.filterToDataSets.includes("users")?(l(),o("div",Y,[n[5]||(n[5]=e("div",{class:"font-bold text-gray-300 mb-1"}," Users ",-1)),e("div",null,[(l(!0),o(g,null,$(c.value.users,r=>(l(),o("div",null,[e("a",{href:"#",onClick:n[1]||(n[1]=C(b=>f(a.voucher),["prevent"])),class:"flex justify-between w-full py-2 border-b",tabindex:"0"},[e("div",Z,[e("div",{innerHTML:v(r.name)},null,8,ee),e("div",{innerHTML:v(r.email)},null,8,te)]),n[4]||(n[4]=e("i",{class:"fa fa-chevron-right flex items-center"},null,-1))])]))),256))])])):d("",!0),c.value.teams.length>0&&x.filterToDataSets.includes("teams")?(l(),o("div",se,[n[7]||(n[7]=e("div",{class:"font-bold text-gray-300 mb-1"}," Teams ",-1)),e("div",null,[(l(!0),o(g,null,$(c.value.teams,r=>(l(),o("div",null,[e("a",{href:"#",onClick:C(b=>f(r),["prevent"]),class:"flex justify-between w-full py-2 border-b",tabindex:"0"},[e("div",ae,[e("div",{innerHTML:v(r.name)},null,8,oe)]),n[6]||(n[6]=e("i",{class:"fa fa-chevron-right flex items-center"},null,-1))],8,le)]))),256))])])):d("",!0),c.value.voucherSets.length>0&&x.filterToDataSets.includes("voucherSets")?(l(),o("div",ne,[n[9]||(n[9]=e("div",{class:"font-bold text-gray-300 mb-1"}," Voucher Sets ",-1)),e("div",null,[(l(!0),o(g,null,$(c.value.voucherSets,r=>(l(),o("div",null,[e("a",{href:"#",onClick:C(b=>f(r),["prevent"]),class:"flex justify-between w-full py-2 border-b",tabindex:"0"},[e("div",ie,[e("div",{innerHTML:v(r.id)},null,8,de)]),n[8]||(n[8]=e("i",{class:"fa fa-chevron-right flex items-center"},null,-1))],8,re)]))),256))])])):d("",!0),c.value.vouchers.length>0&&x.filterToDataSets.includes("vouchers")?(l(),o("div",ue,[n[11]||(n[11]=e("div",{class:"font-bold text-gray-300 mb-1"}," Vouchers ",-1)),e("div",null,[(l(!0),o(g,null,$(c.value.vouchers,r=>(l(),o("div",null,[e("a",{href:"#",onClick:C(b=>f(r),["prevent"]),class:"flex justify-between w-full py-2 border-b",tabindex:"0"},[e("div",ce,[e("div",{innerHTML:v(r.id)},null,8,me),e("div",_e,[e("div",{innerHTML:v("("+r.voucher_short_code+")")},null,8,he)])]),n[10]||(n[10]=e("i",{class:"fa fa-chevron-right flex items-center"},null,-1))],8,ve)]))),256))])])):d("",!0)]),y.value?(l(),o("div",fe,[e("div",{class:"bg-black fixed top-18 w-full h-screen opacity-60 z-10",onClick:n[2]||(n[2]=r=>y.value=!1)}),e("div",pe,[e("div",xe,'No Search Results for "'+i(s.value)+'"',1)])])):d("",!0)])):d("",!0)])],64))}},ge={class:"card"},be={class:"text-xs"},we={key:0,class:"font-bold text-red-500 text-sm"},ke={class:"card"},$e={class:"card-header"},Te={key:0,class:"text-red-500 text-xs font-bold"},Se={class:"grid grid-cols-4 gap-y-12 text-center mt-8"},Me={class:"font-bold text-3xl"},Ce={class:"font-bold text-3xl"},Ve={class:"font-bold text-3xl"},Le={class:"font-bold text-3xl"},Ne={key:0},je={class:"font-bold text-3xl"},Ae={class:"text-xs"},Be={key:1},He={class:"font-bold text-3xl"},De={class:"text-xs"},Re={class:"font-bold text-3xl"},Fe={class:"font-bold text-3xl"},Ee={class:"font-bold text-3xl"},Ue={class:"card"},We={key:0},qe={key:1,class:"text-xs mt-2"},Pe={class:"card"},ze={key:0},Ie={class:"card"},Oe={class:"card-header flex justify-between items-center"},Ge={class:"flex justify-end"},Je={key:0},Ke={key:1},Qe={key:0},Xe={key:1},Ye={class:"border-b py-2 flex justify-between items-center"},Ze={class:"flex justify-end gap-4 items-center"},et={key:0},tt={class:"card"},st={key:0},lt={class:"flex justify-between items-center py-4"},at={class:"text-xs"},ot={class:"flex items-center gap-x-2"},nt={class:"text-xs text-right"},rt={key:0},it={class:"flex justify-end"},dt={class:"card"},kt={__name:"VoucherSet",props:{id:{required:!0}},setup(L){p.extend(G),p.extend(J);const T=L,x=k(!1),s=k({});P(()=>{y()});function c(){x.value=!0}function N(){x.value=!1}function w(v){V.fire({icon:"warning",title:"Add "+v.name+" as merchant for this voucher set?",html:"<div>Note that the selected team must be a merchant of the voucher set's service team.</div>",showCancelButton:!0,confirmButtonText:"Add please!"}).then(t=>{if(t.isConfirmed){let f={voucher_set_id:s.value.id,merchant_team_id:v.id};axios.post("/admin/voucher-set-merchant-teams",f).then(a=>{y()}).catch(a=>{V.fire({icon:"error",title:"Oops..",text:a.response.data.meta.message})})}})}function y(){axios.get("/admin/voucher-sets/"+T.id+"?cached=false&relations=createdByTeam,allocatedToServiceTeam,voucherSetMerchantTeams.merchantTeam,voucherSetMerchantTeamApprovalRequests.merchantUser,voucherSetMerchantTeamApprovalRequests.merchantTeam").then(v=>{s.value=v.data.data}).catch(v=>{console.log(v)})}function j(v){V.fire({icon:"warning",title:"Force-remove Merchant?",html:'<div>Be careful here. This removes this merchant from involvement in this voucher set, and deletes all previous merchant approval requests, regardless of previous state.</div><div class="mt-4">Any emails sent to this merchant previously requesting involvement will not work, as the approval request will have been revoked. This merchant team will not be able to redeem vouchers for this set; they may continue to redeem vouchers for other sets they are involved in.</div>',showCancelButton:!0,confirmButtonText:"Remove please!"}).then(t=>{t.isConfirmed&&axios.delete("/admin/voucher-set-merchant-teams/"+v.id).then(f=>{y()}).catch(f=>{console.log(f)})})}return(v,t)=>(l(),o(g,null,[_(m(z),{title:"Voucher set"}),_(U,null,{header:h(()=>[_(I)]),default:h(()=>{var f;return[e("div",ge,[e("h2",null,i(s.value.name),1),e("div",be," # "+i(T.id),1),s.value.is_test?(l(),o("div",we," Test voucher set ")):d("",!0)]),e("div",ke,[e("div",$e,[t[2]||(t[2]=u(" Voucher set details ")),s.value.voucher_generation_finished_at?d("",!0):(l(),o("span",Te,"Vouchers not generated yet."))]),e("div",Se,[e("div",null,[e("div",Me," $"+i(s.value.total_set_value/100),1),t[3]||(t[3]=u(" Total set value "))]),e("div",null,[e("div",Ce," $"+i(s.value.total_set_value_remaining/100),1),t[4]||(t[4]=u(" Total remaining value "))]),e("div",null,[e("div",Ve,i(s.value.num_vouchers),1),t[5]||(t[5]=u(" # Vouchers "))]),e("div",null,[e("div",Le,i(s.value.num_vouchers_fully_redeemed),1),t[6]||(t[6]=u(" # Vouchers Fully Redeemed "))]),s.value.last_redemption_at?(l(),o("div",Ne,[t[7]||(t[7]=e("div",null," Last redeemed ",-1)),e("div",je,i(m(p).utc(s.value.last_redemption_at).fromNow()),1),e("div",Ae," ("+i(m(p)(s.value.last_redemption_at))+") ",1)])):d("",!0),s.value.expires_at?(l(),o("div",Be,[t[8]||(t[8]=e("div",null," Expires ",-1)),e("div",He,i(m(p).utc(s.value.expires_at).fromNow()),1),e("div",De," ("+i(m(p)(s.value.expires_at))+") ",1)])):d("",!0),e("div",null,[e("div",Re,i(s.value.num_voucher_redemptions),1),t[9]||(t[9]=u(" # Redemptions "))]),e("div",null,[e("div",Fe,i(s.value.num_vouchers_partially_redeemed),1),t[10]||(t[10]=u(" # Vouchers Partially Redeemed "))]),e("div",null,[e("div",Ee,i(s.value.num_vouchers_unredeemed),1),t[11]||(t[11]=u(" # Vouchers Unredeemed "))])])]),e("div",Ue,[t[12]||(t[12]=e("div",{class:"card-header"}," Created by team ",-1)),s.value.created_by_team?(l(),o("div",We,[_(m(M),{href:v.route("admin.team",{id:s.value.created_by_team_id})},{default:h(()=>[u(i(s.value.created_by_team.name),1)]),_:1},8,["href"])])):d("",!0),s.value.created_at?(l(),o("div",qe," Created at: "+i(m(p).utc(s.value.created_at).fromNow())+" ("+i(m(p)(s.value.created_at))+") ",1)):d("",!0)]),e("div",Pe,[t[13]||(t[13]=e("div",{class:"card-header"}," Allocated to team ",-1)),s.value.allocated_to_service_team?(l(),o("div",ze,[_(m(M),{href:v.route("admin.team",{id:s.value.allocated_to_service_team_id})},{default:h(()=>[u(i(s.value.allocated_to_service_team.name),1)]),_:1},8,["href"])])):d("",!0)]),e("div",Ie,[e("div",Oe,[t[16]||(t[16]=e("div",null," Merchant teams ",-1)),e("div",Ge,[x.value?(l(),o("div",Ke,[_(B,{onClick:t[1]||(t[1]=a=>N()),class:"ms-4"},{default:h(()=>t[15]||(t[15]=[u(" Cancel ")])),_:1,__:[15]})])):(l(),o("div",Je,[_(B,{onClick:t[0]||(t[0]=a=>c()),class:"ms-4"},{default:h(()=>t[14]||(t[14]=[u(" Add Merchant Team ")])),_:1,__:[14]})]))])]),x.value?(l(),o("div",Qe,[t[17]||(t[17]=e("div",{class:"py-2 text-xs"},"Select merchant team...",-1)),_(ye,{"filter-to-data-sets":"teams",onItemWasSelected:w})])):d("",!0),s.value.voucher_set_merchant_teams?(l(),o("div",Xe,[(l(!0),o(g,null,$(s.value.voucher_set_merchant_teams,a=>(l(),o("div",null,[e("div",Ye,[_(m(M),{href:v.route("admin.team",{id:a.merchant_team_id})},{default:h(()=>{var n;return[u(i(((n=a.merchant_team)==null?void 0:n.name)??"Merchant team"),1)]}),_:2},1032,["href"]),e("div",Ze,[a.voucher_set_merchant_team_approval_request_id?(l(),o("div",et,t[18]||(t[18]=[e("div",{class:"text-xs"}," Approved. ",-1)]))):d("",!0),_(R,{onClick:n=>j(a)},{default:h(()=>t[19]||(t[19]=[u(" Force Remove? ")])),_:2,__:[19]},1032,["onClick"])])])]))),256))])):d("",!0)]),e("div",tt,[t[24]||(t[24]=e("div",{class:"card-header"},[e("div",null," Merchant team approval requests ")],-1)),t[25]||(t[25]=e("div",{class:"text-xs"}," We only need one user from any merchant team member (per team) to approve that team's participation as merchants. ",-1)),(f=s.value.voucher_set_merchant_team_approval_requests)!=null&&f.length?(l(),o("div",st,[(l(!0),o(g,null,$(s.value.voucher_set_merchant_team_approval_requests,a=>{var n;return l(),o("div",null,[e("div",lt,[e("div",null,[e("div",null,[_(m(M),{class:"font-bold",href:"/admin/team/"+a.merchant_team_id},{default:h(()=>{var r;return[u(i((r=a.merchant_team)==null?void 0:r.name),1)]}),_:2},1032,["href"]),t[20]||(t[20]=u(" | ")),_(m(M),{href:"/admin/user/"+a.merchant_user_id},{default:h(()=>{var r;return[u(i((r=a.merchant_user)==null?void 0:r.name),1)]}),_:2},1032,["href"])]),e("div",at,i((n=a.merchant_user)==null?void 0:n.email),1)]),e("div",null,[e("div",ot,[e("div",nt,[e("div",null," Created: "+i(m(p).utc(a.created_at).fromNow()),1),a.approval_status_last_updated_at?(l(),o("div",rt," Last actioned: "+i(m(p).utc(a.approval_status_last_updated_at).fromNow()),1)):d("",!0)]),e("div",it,[a.approval_status==="ready"?(l(),A(O,{key:0,class:"opacity-40"},{default:h(()=>t[21]||(t[21]=[u(" Ready ")])),_:1,__:[21]})):d("",!0),a.approval_status==="approved"?(l(),A(B,{key:1},{default:h(()=>t[22]||(t[22]=[u(" Approved ")])),_:1,__:[22]})):d("",!0),a.approval_status==="rejected"?(l(),A(R,{key:2},{default:h(()=>t[23]||(t[23]=[u(" Rejected ")])),_:1,__:[23]})):d("",!0)])])])])])}),256))])):d("",!0)]),e("div",dt,[t[26]||(t[26]=e("div",{class:"card-header"}," Vouchers ",-1)),_(K,{"voucher-set-id":T.id},null,8,["voucher-set-id"])]),t[27]||(t[27]=e("div",{class:"pb-32"},null,-1))]}),_:1,__:[27]})],64))}};export{kt as default};
