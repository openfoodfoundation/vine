import{r as b,Q as T,o as O,c as l,a as o,u as v,w as r,F as p,b as a,Z as Q,d as t,t as u,i as y,e as f,f as _,g as h,l as S,m as U,k as z,n as $,h as E}from"./app-DV-zF5mt.js";import{_ as W,S as x}from"./AuthenticatedLayout-BVRnjXib.js";import{_ as Y}from"./AdminTopNavigation-CG6m5o1a.js";import{P as Z}from"./PaginatorComponent-D7QEtqQR.js";import{_ as G}from"./AdminUserDetailsComponent-DLO9JDHk.js";import{P as A}from"./PrimaryButton-Ctf0SoAe.js";import{_ as H}from"./TextInput-ryIT5FeC.js";import{_ as J}from"./SecondaryButton-37npeNYb.js";import"./ApplicationLogo-BvMbtAXr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"card"},R={class:"flex justify-between items-center"},X={key:0},ee={class:"card"},te={class:"card"},se={key:0},ie={key:0},ae={key:0,class:"text-xs text-red-500"},le={class:""},ne={class:"flex justify-end items-center mt-4"},oe={class:"w-full lg:w-1/3"},de={class:"card"},re={for:"admin",class:"cursor-pointer flex justify-start items-center"},ue={class:"card"},me={key:0},ce={class:"border-b py-2"},ve={class:"list-item ml-8"},pe={key:0},fe={class:"ml-8 text-xs"},_e={key:1},he={class:"card"},ke={key:0},be={class:"flex justify-start items-center space-x-4 pb-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 md:gap-2"},ye={class:"border rounded-xl p-4"},xe={class:"text-xs"},Ae={class:"mt-8"},Pe=["for"],we=["id","value"],Ce={class:"pb-4"},Te={class:"flex items-center justify-end mt-4"},Me={__name:"User",props:{id:{required:!0,type:Number}},setup(B){const k=B,V=b(5),n=b({name:"",token_abilities:[]}),P=T().props.personalAccessTokenAbilities,j=T().props.platformAppTokenAbilities,m=b({}),d=b({});O(()=>{g(),w()});function N(){n.value.user_id=d.value.id,axios.post("/admin/user-personal-access-tokens",n.value).then(i=>{let e=i.data.data.token,s=i.data.data.secret;x.fire({title:"Personal access token issued!",html:'<div>Please note that the token will be displayed only once. Make sure to save it securely.</div><div class="mt-4">Token: <b>'+e+'</b></div><div class="mt-4">Secret: <b>'+s+'</b></div><div class="mt-4 text-xs">You will need the secret in order to sign your API requests.</div>',icon:"warning",confirmButtonColor:"#3085d6",confirmButtonText:"Got it!"}).then(c=>{n.value={name:"",token_abilities:[]},g()})}).catch(i=>{x.fire({icon:"error",title:"Oops..",text:i.response.data.meta.message})})}function g(){axios.get("/admin/users/"+k.id+"?cached=false&relations=currentTeam").then(i=>{d.value=i.data.data}).catch(i=>{console.log(i)})}function w(i=1){axios.get("/admin/team-users?cached=false&page="+i+"&where[]=user_id,"+k.id+"&relations=team&limit="+V.value+"&orderBy=id,desc").then(e=>{m.value=e.data.data}).catch(e=>{})}function I(i){w(i)}function C(i){return i.replaceAll("-"," ")}function q(){n.value.token_abilities=Object.keys(j),x.fire({icon:"info",title:"Platform Apps",html:'<div>We have selected the minimum required abilities for an API token for a "Platform" type app.</div><div class="mt-4">Be careful with these abilities, as they can perform additive and destructive actions, like creating teams, users and more API tokens.</div>'})}function D(){n.value.token_abilities=[]}function M(){let i={is_admin:d.value.is_admin};axios.put("/admin/users/"+k.id,i).then(e=>{g()}).catch(e=>{console.log(e)})}return(i,e)=>(a(),l(p,null,[o(v(Q),{title:"Users"}),o(W,null,{header:r(()=>[o(Y)]),default:r(()=>[t("div",K,[t("div",R,[t("h2",null,u(d.value.name),1),t("div",null,[i.$page.props.isImpersonating===null?(a(),l("div",X,[o(A,null,{default:r(()=>[o(v(y),{href:i.route("admin.impersonate",k.id)},{default:r(()=>e[6]||(e[6]=[f("Impersonate")])),_:1},8,["href"])]),_:1})])):_("",!0)])])]),t("div",ee,[e[7]||(e[7]=t("div",{class:"card-header"}," User details ",-1)),o(G,{user:d.value},null,8,["user"])]),t("div",te,[e[8]||(e[8]=t("div",{class:"card-header"}," User teams ",-1)),m.value.data&&m.value.data.length>0?(a(),l("div",se,[(a(!0),l(p,null,h(m.value.data,s=>(a(),E(v(y),{href:i.route("admin.team",s.team_id),class:"hover:no-underline hover:opacity-75"},{default:r(()=>[t("div",{class:$({"border-b p-2":m.value.data.length>1})},[s.team?(a(),l("div",ie,[s.team_id===d.value.current_team_id?(a(),l("div",ae,"*Current team ")):_("",!0),t("div",le,u(s.team.name),1)])):_("",!0)],2)]),_:2},1032,["href"]))),256))])):_("",!0),t("div",ne,[t("div",oe,[o(Z,{onSetDataPage:I,"pagination-data":m.value},null,8,["pagination-data"])])])]),t("div",de,[e[10]||(e[10]=t("div",{class:"card-header"}," Admin status ",-1)),t("label",re,[S(t("input",{onChange:e[0]||(e[0]=s=>M()),type:"checkbox",id:"admin",class:"mr-4","true-value":1,"false-value":0,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.is_admin=s)},null,544),[[U,d.value.is_admin]]),e[9]||(e[9]=f(" User is System Admin "))])]),t("div",ue,[e[11]||(e[11]=t("div",{class:"card-header"}," User Personal Access Tokens (PATs) ",-1)),d.value.tokens&&d.value.tokens.length?(a(),l("div",me,[(a(!0),l(p,null,h(d.value.tokens,s=>(a(),l("div",ce,[o(v(y),{href:i.route("admin.api-access-token",{id:s.id})},{default:r(()=>[t("div",ve,u(s.name),1),s.abilities&&s.abilities.length?(a(),l("div",pe,[(a(!0),l(p,null,h(s.abilities,c=>(a(),l("div",fe," - "+u(C(c)),1))),256))])):_("",!0)]),_:2},1032,["href"])]))),256))])):(a(),l("div",_e,"User does not have PATs."))]),t("div",he,[e[18]||(e[18]=t("div",{class:"card-header"}," Create Personal Access Token ",-1)),v(P).length?(a(),l("div",ke,[e[16]||(e[16]=t("div",{class:"mt-8 mb-4"},[t("h2",null,"Step 1: Select Token Abilities")],-1)),t("div",be,[o(J,{onClick:D},{default:r(()=>e[12]||(e[12]=[f(" Clear Selected ")])),_:1}),e[14]||(e[14]=t("div",{class:"pl-16"}," Quick select: ",-1)),o(A,{onClick:e[2]||(e[2]=s=>q())},{default:r(()=>e[13]||(e[13]=[f(" Platform App ")])),_:1})]),t("div",ge,[(a(!0),l(p,null,h(v(P),s=>(a(),l("div",ye,[t("div",null,[t("h2",null,u(s.name),1),t("div",xe,u(s.description),1),t("div",Ae,[(a(!0),l(p,null,h(s.abilities,(c,F)=>(a(),l("div",null,[t("label",{for:c,class:"cursor-pointer"},[S(t("input",{type:"checkbox",id:c,class:"mr-4",value:F,"onUpdate:modelValue":e[3]||(e[3]=L=>n.value.token_abilities=L)},null,8,we),[[U,n.value.token_abilities]]),f(" "+u(C(c)),1)],8,Pe)]))),256))])])]))),256))]),e[17]||(e[17]=t("div",{class:"mt-8"},[t("h2",null,"Step 2: Give the Token a name")],-1)),t("div",Ce,[o(H,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:n.value.name,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.name=s),required:""},null,8,["modelValue"])]),t("div",null," Selected Abilities: "+u(n.value.token_abilities.join(", ")),1),t("div",Te,[o(A,{onClick:e[5]||(e[5]=z(s=>N(),["prevent"])),class:$(["",{"opacity-25":!n.value.name}]),desabled:!n.value.name},{default:r(()=>e[15]||(e[15]=[f(" Create New Token ")])),_:1},8,["class","desabled"])])])):_("",!0)])]),_:1})],64))}};export{Me as default};
