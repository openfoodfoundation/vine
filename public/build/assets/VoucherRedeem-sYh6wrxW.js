import{r as f,o as V,s as F,c as s,a as i,b as w,u as x,h as T,w as $,d as e,f as g,t as d,e as m,m as B,n as O,x as L,F as b,g as P}from"./app-DC3fkuFb.js";import{_ as S,S as a}from"./AuthenticatedLayout-CYCyMt6B.js";import{d as _}from"./dayjs.min-LcRu0jDd.js";import{r as A}from"./relativeTime-5DkeXmxi.js";import{u as I}from"./utc-BogKdkBq.js";import"./ApplicationLogo-DrEmNjJw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-ByBtFaaS.js";const N={class:"card"},j={class:"title text-2xl"},D={class:"uppercase"},M={class:"my-4"},U={key:0,class:"title text-green text-xl text-green-500"},Y={key:1,class:"title"},q={key:2,class:"title text-red text-lg text-red-500"},z={class:"text-2xl font-bold mt-12"},E={key:3,class:"mt-12"},H={key:0},G={class:"my-4"},J={key:0,class:"my-2 text-red-500"},K={key:0,class:"flex justify-between items-center"},Q={class:"w-1/2 pr-2"},W={class:"w-1/2 pl-2"},X={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-2"},Z={class:""},ee=["disabled"],te={class:""},oe=["disabled"],se={key:4,class:"mt-8"},ie={key:5,class:"mt-12 text-left"},re={class:"title"},le={class:"flex justify-between items-center py-2 border-b"},ne={class:"text-lg"},ae={class:"text-center"},de={class:"text-xs"},ge={__name:"VoucherRedeem",props:{voucher:{type:Object,required:!0}},setup(r){_.extend(A),_.extend(I);const u=r,n=f(!1),v=f(!1),c=f(0),h=f(!1);V(()=>{});function y(){c.value=(parseInt(u.voucher.voucher_value_remaining)/100).toFixed(2),n.value=!0,v.value=!0}function C(){n.value=!1,v.value=!1}function k(){n.value=!0,v.value=!1,a.fire({title:"Redeem all $"+(u.voucher.voucher_value_remaining/100).toFixed(2)+"?",html:"<p>This will fully redeem this voucher.</p>",icon:"warning",showCancelButton:!0,confirmButtonText:"Redeem!",showLoaderOnConfirm:!0,allowOutsideClick:()=>!a.isLoading(),preConfirm:()=>p(u.voucher.voucher_value_remaining.toFixed(0)).catch(o=>{n.value=!1,a.showValidationMessage(o?.response?.data?.meta?.message||"Redemption failed.")})}).then(o=>{o.isConfirmed&&(a.fire({title:"Success!",text:"Your redemption was completed.",icon:"success",showConfirmButton:!1,allowOutsideClick:!1}),setTimeout(()=>window.location.reload(),2e3))})}function R(){n.value=!0,a.fire({title:"Redeem $"+c.value+"?",html:"<p>This will partially redeem this voucher.</p>",icon:"warning",showCancelButton:!0,confirmButtonText:"Redeem!",showLoaderOnConfirm:!0,allowOutsideClick:()=>!a.isLoading(),preConfirm:()=>p((c.value*100).toFixed(0)).catch(o=>{n.value=!1,a.showValidationMessage(o?.response?.data?.meta?.message||"Unknown error")})}).then(o=>{o.isConfirmed&&(a.fire({title:"Success!",text:"Your redemption was completed.",icon:"success",showConfirmButton:!1,allowOutsideClick:!1}),setTimeout(()=>window.location.reload(),2e3))})}async function p(o){n.value=!0;const t={voucher_id:u.voucher.id,voucher_set_id:u.voucher.voucher_set_id,amount:o},l=await axios.post("/voucher-redemptions",t);return v.value=!1,l}return F(c,o=>{h.value=o>0&&parseInt((o*100).toFixed(0))<=parseInt(u.voucher.voucher_value_remaining.toFixed(0))}),(o,t)=>(i(),s(b,null,[w(x(T),{title:"Voucher redeem"}),w(S,null,{default:$(()=>[e("div",N,[e("div",j,[t[5]||(t[5]=g(" Redeem Voucher ",-1)),e("span",D,d(r.voucher.voucher_short_code),1)]),e("div",M,[r.voucher.voucher_value_remaining>0?(i(),s("div",U,"Voucher is Valid ")):(i(),s("div",Y,"Voucher is Fully Redeemed!")),r.voucher.is_test?(i(),s("div",q," This is a test voucher. ")):m("",!0),e("div",null,[e("div",z," $"+d((r.voucher.voucher_value_remaining/100).toFixed(2))+" remaining ",1),e("div",null," of $"+d((r.voucher.voucher_value_original/100).toFixed(2))+" original value ",1)]),r.voucher.voucher_value_remaining>0?(i(),s("div",E,[v.value?(i(),s("div",H,[e("div",G,[t[6]||(t[6]=g(" How much should be redeemed? ",-1)),B(e("input",{inputmode:"decimal",pattern:"[0-9]*",type:"text",step:"0.01","onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),class:O(["w-full text-center text-xl rounded p-8 border-2 focus:outline-none",{"border-green-500":h.value,"border-red-500":!h.value}]),min:"0.01"},null,2),[[L,c.value,void 0,{number:!0}]]),h.value?m("",!0):(i(),s("div",J," Invalid redemption amount. "))]),h.value?(i(),s("div",K,[e("div",Q,[e("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",onClick:t[1]||(t[1]=l=>C())}," Cancel ")]),e("div",W,[e("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",onClick:t[2]||(t[2]=l=>R())}," Redeem ")])])):m("",!0)])):(i(),s("div",X,[e("div",Z,[e("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",disabled:n.value,onClickOnce:t[3]||(t[3]=l=>y())}," Redeem PART ",40,ee)]),e("div",te,[e("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",disabled:n.value,onClickOnce:t[4]||(t[4]=l=>k())}," Redeem ALL ",40,oe)])]))])):m("",!0),r.voucher.voucher_redemptions?m("",!0):(i(),s("div",se,[...t[7]||(t[7]=[e("button",{class:"w-full p-2 rounded border"}," See Redemptions ",-1)])])),r.voucher.voucher_redemptions?(i(),s("div",ie,[e("div",re," Redemptions ("+d(r.voucher.voucher_redemptions.length)+") ",1),e("div",null,[(i(!0),s(b,null,P(r.voucher.voucher_redemptions,l=>(i(),s("div",le,[e("div",null,[e("div",ne," $"+d((l.redeemed_amount/100).toFixed(2)),1)]),e("div",ae,[g(d(x(_).utc(l.created_at).fromNow())+" ",1),e("div",de," ("+d(x(_)(l.created_at))+") ",1)])]))),256))])])):m("",!0)])])]),_:1})],64))}};export{ge as default};
