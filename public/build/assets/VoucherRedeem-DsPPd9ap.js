import{r as _,o as F,q as T,c as i,a as l,b,u as g,g as $,w as B,d as t,f as p,t as r,e as v,l as O,n as L,s as P,F as y,h as S}from"./app-IWLyLub1.js";import{_ as A,S as d}from"./AuthenticatedLayout-mRDDIZ3i.js";import{d as x}from"./dayjs.min-ED448bi3.js";import{r as I}from"./relativeTime-CJVd6KgW.js";import{u as N}from"./utc-D72GDbaS.js";import"./ApplicationLogo-Can6C0RZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-D2NOLlcZ.js";const j={class:"card"},D={class:"title text-2xl"},M={class:"uppercase"},q={class:"my-4"},U={key:0,class:"title text-green text-xl text-green-500"},Y={key:1,class:"title"},z={key:2,class:"title text-red text-lg text-red-500"},E={class:"text-2xl font-bold mt-12"},H={key:3,class:"mt-12"},G={key:0},J={class:"my-4"},K={key:0,class:"my-2 text-red-500"},Q={key:0,class:"flex justify-between items-center"},W={class:"w-1/2 pr-2"},X={class:"w-1/2 pl-2"},Z={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-2"},ee={class:""},te=["disabled"],oe={class:""},se=["disabled"],ie={key:4,class:"mt-8"},le={key:5,class:"mt-12 text-left"},ne={class:"title"},ae={class:"flex justify-between items-center py-2 border-b"},de={class:"text-lg"},re={class:"text-center"},ue={class:"text-xs"},pe={__name:"VoucherRedeem",props:{voucher:{type:Object,required:!0}},setup(n){x.extend(I),x.extend(N);const u=n,a=_(!1),m=_(!1),c=_(0),h=_(!1);F(()=>{});function C(){c.value=(parseInt(u.voucher.voucher_value_remaining)/100).toFixed(2),a.value=!0,m.value=!0}function k(){a.value=!1,m.value=!1}function R(){a.value=!0,m.value=!1,d.fire({title:"Redeem all $"+(u.voucher.voucher_value_remaining/100).toFixed(2)+"?",html:"<p>This will fully redeem this voucher.</p>",icon:"warning",showCancelButton:!0,confirmButtonText:"Redeem!",showLoaderOnConfirm:!0,allowOutsideClick:()=>!d.isLoading(),preConfirm:()=>w(u.voucher.voucher_value_remaining.toFixed(0)).catch(o=>{var e,s,f;a.value=!1,d.showValidationMessage(((f=(s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.meta)==null?void 0:f.message)||"Redemption failed.")})}).then(o=>{o.isConfirmed&&(d.fire({title:"Success!",text:"Your redemption was completed.",icon:"success",showConfirmButton:!1,allowOutsideClick:!1}),setTimeout(()=>window.location.reload(),2e3))})}function V(){a.value=!0,d.fire({title:"Redeem $"+c.value+"?",html:"<p>This will partially redeem this voucher.</p>",icon:"warning",showCancelButton:!0,confirmButtonText:"Redeem!",showLoaderOnConfirm:!0,allowOutsideClick:()=>!d.isLoading(),preConfirm:()=>w((c.value*100).toFixed(0)).catch(o=>{var e,s,f;a.value=!1,d.showValidationMessage(((f=(s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.meta)==null?void 0:f.message)||"Unknown error")})}).then(o=>{o.isConfirmed&&(d.fire({title:"Success!",text:"Your redemption was completed.",icon:"success",showConfirmButton:!1,allowOutsideClick:!1}),setTimeout(()=>window.location.reload(),2e3))})}async function w(o){a.value=!0;const e={voucher_id:u.voucher.id,voucher_set_id:u.voucher.voucher_set_id,amount:o},s=await axios.post("/voucher-redemptions",e);return m.value=!1,s}return T(c,o=>{h.value=o>0&&parseInt((o*100).toFixed(0))<=parseInt(u.voucher.voucher_value_remaining.toFixed(0))}),(o,e)=>(l(),i(y,null,[b(g($),{title:"Voucher redeem"}),b(A,null,{default:B(()=>[t("div",j,[t("div",D,[e[5]||(e[5]=p(" Redeem Voucher ")),t("span",M,r(n.voucher.voucher_short_code),1)]),t("div",q,[n.voucher.voucher_value_remaining>0?(l(),i("div",U,"Voucher is Valid ")):(l(),i("div",Y,"Voucher is Fully Redeemed!")),n.voucher.is_test?(l(),i("div",z," This is a test voucher. ")):v("",!0),t("div",null,[t("div",E," $"+r((n.voucher.voucher_value_remaining/100).toFixed(2))+" remaining ",1),t("div",null," of $"+r((n.voucher.voucher_value_original/100).toFixed(2))+" original value ",1)]),n.voucher.voucher_value_remaining>0?(l(),i("div",H,[m.value?(l(),i("div",G,[t("div",J,[e[6]||(e[6]=p(" How much should be redeemed? ")),O(t("input",{inputmode:"decimal",pattern:"[0-9]*",type:"text",step:"0.01","onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:L(["w-full text-center text-xl rounded p-8 border-2 focus:outline-none",{"border-green-500":h.value,"border-red-500":!h.value}]),min:"0.01"},null,2),[[P,c.value,void 0,{number:!0}]]),h.value?v("",!0):(l(),i("div",K," Invalid redemption amount. "))]),h.value?(l(),i("div",Q,[t("div",W,[t("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",onClick:e[1]||(e[1]=s=>k())}," Cancel ")]),t("div",X,[t("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",onClick:e[2]||(e[2]=s=>V())}," Redeem ")])])):v("",!0)])):(l(),i("div",Z,[t("div",ee,[t("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",disabled:a.value,onClickOnce:e[3]||(e[3]=s=>C())}," Redeem PART ",40,te)]),t("div",oe,[t("button",{class:"w-full p-8 font-bold text-2xl rounded border bg-gray-300",disabled:a.value,onClickOnce:e[4]||(e[4]=s=>R())}," Redeem ALL ",40,se)])]))])):v("",!0),n.voucher.voucher_redemptions?v("",!0):(l(),i("div",ie,e[7]||(e[7]=[t("button",{class:"w-full p-2 rounded border"}," See Redemptions ",-1)]))),n.voucher.voucher_redemptions?(l(),i("div",le,[t("div",ne," Redemptions ("+r(n.voucher.voucher_redemptions.length)+") ",1),t("div",null,[(l(!0),i(y,null,S(n.voucher.voucher_redemptions,s=>(l(),i("div",ae,[t("div",null,[t("div",de," $"+r((s.redeemed_amount/100).toFixed(2)),1)]),t("div",re,[p(r(g(x).utc(s.created_at).fromNow())+" ",1),t("div",ue," ("+r(g(x)(s.created_at))+") ",1)])]))),256))])])):v("",!0)])])]),_:1})],64))}};export{pe as default};
