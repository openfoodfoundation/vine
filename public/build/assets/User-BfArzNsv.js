import{r as g,m as _,o as L,c as l,a,b as d,u,g as W,w as r,d as t,t as m,e as c,S as P,f as p,F as h,h as k,i as Y,n as w,l as U,p as $,k as z}from"./app-Bq_83vTq.js";import{_ as Q,S as y}from"./AuthenticatedLayout-D-l_4O4-.js";import{_ as G}from"./AdminTopNavigation-CPMtviZo.js";import{P as H}from"./PaginatorComponent-DfdrUXmz.js";import{_ as J}from"./AdminUserDetailsComponent-QbrtcfT4.js";import{P as A}from"./PrimaryButton-W7w1Yp-s.js";import{_ as K}from"./TextInput-BZp4R1RG.js";import{_ as X}from"./SecondaryButton-BEVnI3bX.js";import"./ApplicationLogo-BjD9D5hm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"card"},ee={class:"flex justify-between items-center"},te={key:0},se={class:"card"},ie={class:"card"},ae={key:0},le={key:0},oe={key:0,class:"text-xs text-red-500"},ne={class:""},de={class:"flex justify-end items-center mt-4"},re={class:"w-full lg:w-1/3"},ue={class:"card"},me=["disabled"],ce={key:0,class:"text-xs mt-2 italic"},pe={class:"card"},ve={key:0},fe={class:"border-b py-2"},_e={class:"list-item ml-8"},he={key:0},ke={class:"ml-8 text-xs"},be={key:1},ge={class:"card"},ye={key:0},Ae={class:"flex justify-start items-center space-x-4 pb-4"},xe={class:"grid grid-cols-1 md:grid-cols-2 md:gap-2"},Pe={class:"border rounded-xl p-4"},we={class:"text-xs"},Te={class:"mt-8"},Ce=["for"],Se=["id","value"],Ue={class:"pb-4"},$e={class:"flex items-center justify-end mt-4"},Oe={__name:"User",props:{id:{required:!0,type:Number}},setup(B){const b=B,V=g(5),n=g({name:"",token_abilities:[]}),T=_().props.personalAccessTokenAbilities,j=_().props.platformAppTokenAbilities,I=_().props.redemptionAppTokenAbilities,v=g({}),o=g({});L(()=>{x(),C()});function N(){n.value.user_id=o.value.id,axios.post("/admin/user-personal-access-tokens",n.value).then(i=>{let e=i.data.data.token,s=i.data.data.secret;y.fire({title:"Personal access token issued!",html:'<div>Please note that the token will be displayed only once. Make sure to save it securely.</div><div class="mt-4">Token: <b>'+e+'</b></div><div class="mt-4">Secret: <b>'+s+'</b></div><div class="mt-4 text-xs">You will need the secret in order to sign your API requests.</div>',icon:"warning",confirmButtonColor:"#3085d6",confirmButtonText:"Got it!"}).then(f=>{n.value={name:"",token_abilities:[]},x()})}).catch(i=>{y.fire({icon:"error",title:"Oops..",text:i.response.data.meta.message})})}function x(){axios.get("/admin/users/"+b.id+"?cached=false&relations=currentTeam").then(i=>{o.value=i.data.data}).catch(i=>{console.log(i)})}function C(i=1){axios.get("/admin/team-users?cached=false&page="+i+"&where[]=user_id,"+b.id+"&relations=team&limit="+V.value+"&orderBy=id,desc").then(e=>{v.value=e.data.data}).catch(e=>{})}function q(i){C(i)}function S(i){return i.replaceAll("-"," ")}function D(){n.value.token_abilities=Object.keys(j),y.fire({icon:"info",title:"Platform Apps",html:'<div>We have selected the minimum required abilities for an API token for a "Platform" type app.</div><div class="mt-4">Be careful with these abilities, as they can perform additive and destructive actions, like creating teams, users and more API tokens.</div>'})}function M(){n.value.token_abilities=Object.keys(I),y.fire({icon:"info",title:"Redemption Apps",html:'<div>We have selected the minimum required abilities for an API token for a "Redemption" type app.</div><div class="mt-4">Be careful with these abilities, as they can redeem vouchers. Ensure the correct rights have been assigned.</div>'})}function R(){n.value.token_abilities=[]}function F(){let i={is_admin:o.value.is_admin};axios.put("/admin/users/"+b.id,i).then(e=>{x()}).catch(e=>{console.log(e)})}return(i,e)=>(a(),l(h,null,[d(u(W),{title:"Users"}),d(Q,null,{header:r(()=>[d(G)]),default:r(()=>[t("div",Z,[t("div",ee,[t("h2",null,m(o.value.name),1),t("div",null,[i.$page.props.isImpersonating===null?(a(),l("div",te,[d(A,null,{default:r(()=>[d(u(P),{href:i.route("admin.impersonate",b.id)},{default:r(()=>e[7]||(e[7]=[p("Impersonate")])),_:1,__:[7]},8,["href"])]),_:1})])):c("",!0)])])]),t("div",se,[e[8]||(e[8]=t("div",{class:"card-header"}," User details ",-1)),d(J,{user:o.value},null,8,["user"])]),t("div",ie,[e[9]||(e[9]=t("div",{class:"card-header"}," User teams ",-1)),v.value.data&&v.value.data.length>0?(a(),l("div",ae,[(a(!0),l(h,null,k(v.value.data,s=>(a(),Y(u(P),{href:i.route("admin.team",s.team_id),class:"hover:no-underline hover:opacity-75"},{default:r(()=>[t("div",{class:w({"border-b p-2":v.value.data.length>1})},[s.team?(a(),l("div",le,[s.team_id===o.value.current_team_id?(a(),l("div",oe,"*Current team ")):c("",!0),t("div",ne,m(s.team.name),1)])):c("",!0)],2)]),_:2},1032,["href"]))),256))])):c("",!0),t("div",de,[t("div",re,[d(H,{onSetDataPage:q,"pagination-data":v.value},null,8,["pagination-data"])])])]),t("div",ue,[e[11]||(e[11]=t("div",{class:"card-header"}," Admin status ",-1)),t("label",{for:"admin",class:w(["cursor-pointer flex justify-start items-center",{"opacity-30":o.value.id===u(_)().props.auth.user.id}])},[U(t("input",{onChange:e[0]||(e[0]=s=>F()),type:"checkbox",id:"admin",class:"mr-4","true-value":1,"false-value":0,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.is_admin=s),disabled:o.value.id===u(_)().props.auth.user.id},null,40,me),[[$,o.value.is_admin]]),e[10]||(e[10]=p(" User is System Admin "))],2),o.value.id===u(_)().props.auth.user.id?(a(),l("div",ce," You can't change your own user admin status. ")):c("",!0)]),t("div",pe,[e[12]||(e[12]=t("div",{class:"card-header"}," User Personal Access Tokens (PATs) ",-1)),o.value.tokens&&o.value.tokens.length?(a(),l("div",ve,[(a(!0),l(h,null,k(o.value.tokens,s=>(a(),l("div",fe,[d(u(P),{href:i.route("admin.api-access-token",{id:s.id})},{default:r(()=>[t("div",_e,m(s.name),1),s.abilities&&s.abilities.length?(a(),l("div",he,[(a(!0),l(h,null,k(s.abilities,f=>(a(),l("div",ke," - "+m(S(f)),1))),256))])):c("",!0)]),_:2},1032,["href"])]))),256))])):(a(),l("div",be,"User does not have PATs."))]),t("div",ge,[e[20]||(e[20]=t("div",{class:"card-header"}," Create Personal Access Token ",-1)),u(T).length?(a(),l("div",ye,[e[18]||(e[18]=t("div",{class:"mt-8 mb-4"},[t("h2",null,"Step 1: Select Token Abilities")],-1)),t("div",Ae,[d(X,{onClick:R},{default:r(()=>e[13]||(e[13]=[p(" Clear Selected ")])),_:1,__:[13]}),e[16]||(e[16]=t("div",{class:"pl-16"}," Quick select: ",-1)),d(A,{onClick:e[2]||(e[2]=s=>D())},{default:r(()=>e[14]||(e[14]=[p(" Platform App ")])),_:1,__:[14]}),d(A,{onClick:e[3]||(e[3]=s=>M())},{default:r(()=>e[15]||(e[15]=[p(" Redemption App ")])),_:1,__:[15]})]),t("div",xe,[(a(!0),l(h,null,k(u(T),s=>(a(),l("div",Pe,[t("div",null,[t("h2",null,m(s.name),1),t("div",we,m(s.description),1),t("div",Te,[(a(!0),l(h,null,k(s.abilities,(f,O)=>(a(),l("div",null,[t("label",{for:f,class:"cursor-pointer"},[U(t("input",{type:"checkbox",id:f,class:"mr-4",value:O,"onUpdate:modelValue":e[4]||(e[4]=E=>n.value.token_abilities=E)},null,8,Se),[[$,n.value.token_abilities]]),p(" "+m(S(f)),1)],8,Ce)]))),256))])])]))),256))]),e[19]||(e[19]=t("div",{class:"mt-8"},[t("h2",null,"Step 2: Give the Token a name")],-1)),t("div",Ue,[d(K,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:n.value.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.name=s),required:""},null,8,["modelValue"])]),t("div",null," Selected Abilities: "+m(n.value.token_abilities.join(", ")),1),t("div",$e,[d(A,{onClick:e[6]||(e[6]=z(s=>N(),["prevent"])),class:w(["",{"opacity-25":!n.value.name}]),desabled:!n.value.name},{default:r(()=>e[17]||(e[17]=[p(" Create New Token ")])),_:1,__:[17]},8,["class","desabled"])])])):c("",!0)])]),_:1})],64))}};export{Oe as default};
