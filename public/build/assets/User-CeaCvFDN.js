import{r as f,Q as w,o as F,a as s,b as a,d as n,u as v,w as c,F as m,Z as I,e,t as d,j as h,h as p,f as k,m as L,n as C,k as O,i as T,p as Q,v as z}from"./app-ClCJcWW-.js";import{_ as E}from"./AuthenticatedLayout-DSVsSXG6.js";import{_ as W}from"./AdminTopNavigation-yTEVNZVX.js";import{S as b}from"./sweetalert2.all-BxHbwWoH.js";import{P as Z}from"./PaginatorComponent-Bu2dN7Jx.js";import{_ as G}from"./AdminUserDetailsComponent-C4TSDZmY.js";import{P as U}from"./PrimaryButton-DnWz4roc.js";import{_ as H}from"./TextInput-Dluw6uBu.js";import{_ as J}from"./SecondaryButton-Bv260Y3G.js";import"./ApplicationLogo-BahlM8sz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"card"},R={class:"card"},X=e("div",{class:"card-header"}," User details ",-1),Y={class:"card"},ee=e("div",{class:"card-header"}," User teams ",-1),te={key:0},se={key:0},ae={key:0,class:"text-xs text-red-500"},ie={class:""},oe={class:"flex justify-end items-center mt-4"},le={class:"w-full lg:w-1/3"},ne={class:"card"},re=e("div",{class:"card-header"}," User Personal Access Tokens (PATs) ",-1),de={key:0},ce={class:"border-b py-2"},ue={class:"list-item ml-8"},me={key:0},_e={class:"ml-8 text-xs"},ve={key:1},he={class:"card"},pe=e("div",{class:"card-header"}," Create Personal Access Token ",-1),fe={key:0},ke=e("div",{class:"mt-8 mb-4"},[e("h2",null,"Step 1: Select Token Abilities")],-1),be={class:"flex justify-start items-center space-x-4 pb-4"},ge=e("div",{class:"pl-16"}," Quick select: ",-1),xe={class:"grid grid-cols-1 md:grid-cols-2 md:gap-2"},Ae={class:"border rounded-xl p-4"},ye={class:"text-xs"},Pe={class:"mt-8"},we=["for"],Ce=["id","value"],Te=e("div",{class:"mt-8"},[e("h2",null,"Step 2: Give the Token a name")],-1),Ue={class:"pb-4"},Be={class:"flex items-center justify-end mt-4"},Oe={__name:"User",props:{id:{required:!0,type:Number}},setup(B){const g=B,S=f(5),l=f({name:"",token_abilities:[]}),x=w().props.personalAccessTokenAbilities,V=w().props.platformAppTokenAbilities,u=f({}),r=f({});F(()=>{A(),y()});function $(){l.value.user_id=r.value.id,axios.post("/admin/user-personal-access-tokens",l.value).then(i=>{let o=i.data.data.token;b.fire({title:"Personal access token issued!",html:"Please note that the token will be displayed only once. Make sure to save it securely. </br> <b>"+o+"</b>",icon:"warning",confirmButtonColor:"#3085d6",confirmButtonText:"Got it"}).then(t=>{l.value={name:"",token_abilities:[]},A()})}).catch(i=>{b.fire({icon:"error",title:"Oops..",text:i.response.data.meta.message})})}function A(){axios.get("/admin/users/"+g.id+"?cached=false&relations=currentTeam").then(i=>{r.value=i.data.data}).catch(i=>{console.log(i)})}function y(i=1){axios.get("/admin/team-users?cached=false&page="+i+"&where[]=user_id,"+g.id+"&relations=team&limit="+S.value+"&orderBy=id,desc").then(o=>{u.value=o.data.data}).catch(o=>{})}function j(i){y(i)}function P(i){return i.replaceAll("-"," ")}function N(){l.value.token_abilities=Object.keys(V),b.fire({icon:"info",title:"Platform Apps",html:'<div>We have selected the minimum required abilities for an API token for a "Platform" type app.</div><div class="mt-4">Be careful with these abilities, as they can perform additive and destructive actions, like creating teams, users and more API tokens.</div>'})}function D(){l.value.token_abilities=[]}return(i,o)=>(s(),a(m,null,[n(v(I),{title:"Users"}),n(E,null,{header:c(()=>[n(W)]),default:c(()=>[e("div",K,[e("h2",null,d(r.value.name),1)]),e("div",R,[X,n(G,{user:r.value},null,8,["user"])]),e("div",Y,[ee,u.value.data&&u.value.data.length>0?(s(),a("div",te,[(s(!0),a(m,null,h(u.value.data,t=>(s(),O(v(T),{href:i.route("admin.team",t.team_id),class:"hover:no-underline hover:opacity-75"},{default:c(()=>[e("div",{class:C({"border-b p-2":u.value.data.length>1})},[t.team?(s(),a("div",se,[t.team_id===r.value.current_team_id?(s(),a("div",ae,"*Current team ")):p("",!0),e("div",ie,d(t.team.name),1)])):p("",!0)],2)]),_:2},1032,["href"]))),256))])):p("",!0),e("div",oe,[e("div",le,[n(Z,{onSetDataPage:j,"pagination-data":u.value},null,8,["pagination-data"])])])]),e("div",ne,[re,r.value.tokens&&r.value.tokens.length?(s(),a("div",de,[(s(!0),a(m,null,h(r.value.tokens,t=>(s(),a("div",ce,[n(v(T),{href:i.route("admin.api-access-token",{id:t.id})},{default:c(()=>[e("div",ue,d(t.name),1),t.abilities&&t.abilities.length?(s(),a("div",me,[(s(!0),a(m,null,h(t.abilities,_=>(s(),a("div",_e," - "+d(P(_)),1))),256))])):p("",!0)]),_:2},1032,["href"])]))),256))])):(s(),a("div",ve,"User does not have PATs."))]),e("div",he,[pe,v(x).length?(s(),a("div",fe,[ke,e("div",be,[n(J,{onClick:D},{default:c(()=>[k(" Clear Selected ")]),_:1}),ge,n(U,{onClick:o[0]||(o[0]=t=>N())},{default:c(()=>[k(" Platform App ")]),_:1})]),e("div",xe,[(s(!0),a(m,null,h(v(x),t=>(s(),a("div",Ae,[e("div",null,[e("h2",null,d(t.name),1),e("div",ye,d(t.description),1),e("div",Pe,[(s(!0),a(m,null,h(t.abilities,(_,M)=>(s(),a("div",null,[e("label",{for:_,class:"cursor-pointer"},[Q(e("input",{type:"checkbox",id:_,class:"mr-4",value:M,"onUpdate:modelValue":o[1]||(o[1]=q=>l.value.token_abilities=q)},null,8,Ce),[[z,l.value.token_abilities]]),k(" "+d(P(_)),1)],8,we)]))),256))])])]))),256))]),Te,e("div",Ue,[n(H,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:l.value.name,"onUpdate:modelValue":o[2]||(o[2]=t=>l.value.name=t),required:""},null,8,["modelValue"])]),e("div",null," Selected Abilities: "+d(l.value.token_abilities.join(", ")),1),e("div",Be,[n(U,{onClick:o[3]||(o[3]=L(t=>$(),["prevent"])),class:C(["",{"opacity-25":!l.value.name}]),desabled:!l.value.name},{default:c(()=>[k(" Create New Token ")]),_:1},8,["class","desabled"])])])):p("",!0)])]),_:1})],64))}};export{Oe as default};
